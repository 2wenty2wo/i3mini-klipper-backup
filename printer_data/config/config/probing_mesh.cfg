# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# PROBING & MESH: BLTouch, safe Z home at center, mesh area, screw adjust
# Y offset is -37.5 (probe in front of nozzle). Mesh limits are PROBE coords.
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# BLTouch â€” control via Pi (host MCU)
[bltouch]
sensor_pin: ^PD7
control_pin: rpi:gpio17
x_offset: 0.0
y_offset: -37.5
# z_offset is managed by SAVE_CONFIG; leave commented here on purpose
# z_offset: 3.850
probe_with_touch_mode: False
pin_up_reports_not_triggered: True
pin_up_touch_mode_reports_triggered: False
pin_move_time: 0.60                  # a touch slower for reliability
samples: 3                           # take 3 touches per point
samples_result: median               # ignore outliers automatically
samples_tolerance: 0.020             # allow 20 Âµm variation
samples_tolerance_retries: 5         # retry instead of failing outright

# Home X/Y, then probe center for Z using the BLTouch
[safe_z_home]
home_xy_position: 60,104.5
z_hop: 5
z_hop_speed: 5

# Bed mesh in PROBE coordinates (keeps nozzle â‰¤ Y135 limit)
[bed_mesh]
speed: 120
horizontal_move_z: 5
mesh_min: 5, 5
mesh_max: 115, 177.5
probe_count: 5,5
algorithm: bicubic
fade_start: 1.0            # begin fading mesh correction above Z=1 mm
fade_end: 10.0             # stop corrections above Z=10 mm
fade_target: 0             # flatten to ideal plane

# 4â€‘screw plane tramming using the probe
[screws_tilt_adjust]
# probe_y = nozzle_y + (-37.5)
# front row:  nozzle_y â‰ˆ 45  -> probe_y â‰ˆ 7.5   (â‰¥ min 5)
# back row:   nozzle_y â‰ˆ 130 -> probe_y â‰ˆ 92.5  (â‰¤ max 97.5)
screw1:  15,  45   # front-left
screw2: 110,  45   # front-right
screw3: 110, 210   # back-right
screw4:  15, 210   # back-left
horizontal_move_z: 10
speed: 100
screw_thread: CW-M3   # If directions feel backwards, change to CCW-M3

# Convenience wrapper to run 4-corner adjust
[gcode_macro LEVEL_BED]
description: ðŸ”§ Probe 4 corners for screw adjust
gcode:
  G28
  SCREWS_TILT_CALCULATE
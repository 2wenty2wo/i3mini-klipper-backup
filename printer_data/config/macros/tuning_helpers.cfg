# ─────────────────────────────────────────────────────────────────────────────
# TUNING HELPERS: convenience macros for ADXL sanity + shaper calibration
# ─────────────────────────────────────────────────────────────────────────────

[gcode_macro ADXL_SANITY]
description: Check accelerometer is responding and noise is reasonable
gcode:
  RESPOND PREFIX=ADXL MSG="Querying accelerometer…"
  ACCELEROMETER_QUERY
  MEASURE_AXES_NOISE


[gcode_macro RESO_TUNE]
description: Home, warm nozzle, run SHAPER_CALIBRATE on X/Y, then prompt to SAVE_CONFIG
variable_temp: 200
gcode:
  {% set t = params.TEMP|default(printer["gcode_macro RESO_TUNE"].temp)|int %}
  M117 Resonance tune starting…
  {% if printer.toolhead.homed_axes != "xyz" %} G28 {% endif %}
  M104 S{t}
  M109 S{t}
  G90
  {% set x = printer.toolhead.axis_maximum.x / 2 %}
  {% set y = printer.toolhead.axis_maximum.y / 2 %}
  G1 X{ x|round(1) } Y{ y|round(1) } Z20 F6000
  MEASURE_AXES_NOISE
  SHAPER_CALIBRATE
  M117 Review console output; run SAVE_CONFIG if happy


[gcode_macro TEST_AREA]
gcode:
  G90
  G1 X0 Y0 F3000
  G1 X{printer.toolhead.axis_maximum.x} Y0 F3000
  G1 X{printer.toolhead.axis_maximum.x} Y{printer.toolhead.axis_maximum.y} F3000
  G1 X0 Y{printer.toolhead.axis_maximum.y} F3000
  G1 X0 Y0 F3000


# ────────────────────────────────────────────────
# BED_PID_TUNE — convenience macro for bed PID tuning
# Usage:
#   BED_PID_TUNE TARGET=60
#   (default is 60 °C if no TARGET is given)
# ────────────────────────────────────────────────
[gcode_macro BED_PID_TUNE]
description: Run PID calibration on the heated bed at a chosen target temp
gcode:
  {% set target = params.TARGET|default(60)|int %}
  M117 PID tuning bed to {target}°C...
  PID_CALIBRATE HEATER=heater_bed TARGET={target}
  M117 PID tune complete; run SAVE_CONFIG


# ────────────────────────────────────────────────
# HOTEND_PID_TUNE — convenience macro for hotend PID tuning
# Usage:
#   HOTEND_PID_TUNE TARGET=200
#   (default is 200 °C if no TARGET is given)
# ────────────────────────────────────────────────
[gcode_macro HOTEND_PID_TUNE]
description: Run PID calibration on the hotend at a chosen target temp
gcode:
  {% set target = params.TARGET|default(200)|int %}
  M117 PID tuning hotend to {target}°C...
  PID_CALIBRATE HEATER=extruder TARGET={target}
  M117 PID tune complete; run SAVE_CONFIG